<h1 id="fastai-course-v4-with-google-colab-and-vs-code">Fast.AI Course V4 with Google Colab and VS Code</h1>

<p>The latest version of the popular Fast.AI course is now underway and due to the limitation of Corona Virus, this has moved online. Though the videos will be available to general public on July, you can still access the notebooks of the latest version here.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/fastai/course-v4
</code></pre></div></div>

<p>The course will be largely based out of the <a href="https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527">book</a>, which is scheduled to release on July 2020 as well.</p>

<p>Though Google Colab gives you a notebook “like” interface, it would be difficult in using this as a development environment. In this post we will see on how we can use the underling hardware of Google Colab to setup a VS Code based GPU/TPU environment.</p>

<p>To do this we will use the two services listed below.</p>

<ul>
  <li><a href="https://coder.com/">Coder</a>, which provides us with the option to run VS Code, accessible via browser through <a href="https://github.com/cdr/code-server">Code-server</a>.</li>
  <li><a href="https://ngrok.com/">Ngrok</a>, which provides public and secure access by enabling URLs to your local application.</li>
</ul>

<h3 id="mount-google-drive">Mount Google Drive</h3>

<p>Mount your Google drive with the command below, you’ll be asked to enter an authorization code that will be provided as output of the cell below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/content/gdrive/'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="clone-fastbook">Clone fastbook</h3>

<p>Now clone the latest version of ‘fastbook’ from the github repository, into the Google Drive.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">!git clone https://github.com/fastai/course-v4 'drive/My Drive/course-v4'
</span></code></pre></div></div>

<h3 id="download-and-unzip-the-required-packages">Download and unzip the required packages</h3>

<p>We will need latest release of code-server and ngrok, to enable the setup. Let us download and decompress the files.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">!curl -sSL https://github.com/cdr/code-server/releases/download/2.1698/code-server2.1698-vsc1.41.1-linux-x86_64.tar.gz| tar -xvz
!wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
!unzip ngrok-stable-linux-amd64.zip
</span></code></pre></div></div>

<h3 id="generate-authtoken">Generate Authtoken</h3>

<p>Create a free account in <a href="https://ngrok.com/">Ngrok</a>, this will be used forward the port where code-server runs. This step needs to be done to avoid too many connections error (greater than 20 connections within 60 seconds, which is a limitation for un-registered accounts)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Get your authtoken from https://dashboard.ngrok.com/auth"</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="n">authtoken</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="create-tunnel">Create tunnel</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">!./ngrok authtoken $</span>authtoken &amp; ./ngrok http 8443 <span class="nt">--log</span><span class="o">=</span>stdout &amp; ./code-server2.1698-vsc1.41.1-linux-x86_64/code-server <span class="nt">--port</span> <span class="s1">'8443'</span> <span class="nt">--auth</span> <span class="s1">'none'</span>
</code></pre></div></div>

<p>Output from the cell will have a link, ending with the format **http://<random_number>.ngrok.io**</random_number></p>

<p><img src="/blog/images/2020-03-19-Colab_VS_Code/\image-20200319194723416.png" alt="image-20200319194723416" /></p>

<p>Access the URL to get a VS Code interface. Now let us enable ipython notebook support by installing the <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Microsoft Python Extension</a>.</p>

<p>Go to ‘Extensions’ option in the VS Code, and search for ‘Python’ and click on ‘Install’.</p>

<p><img src="/blog/images/2020-03-19-Colab_VS_Code/\image-20200319194735469.png" alt="image-20200319194735469" /></p>

<p>Once done, reload the VS Code UI by clicking on ‘Reload Required’. This will enable the installed plugin.</p>

<p><img src="/blog/images/2020-03-19-Colab_VS_Code/\image-20200319195926238.png" alt="image-20200319195926238" /></p>

<p>To set the working directory, click on the ‘Explorer’ button, on the text box, type the directory where ‘fasbook’ was cloned initially.</p>

<p><img src="/blog/images/2020-03-19-Colab_VS_Code/\image-20200319204759447.png" alt="image-20200319204759447" /></p>

<p>This will list all the notebooks on the left, select the notebook you want to work with and proceed as usual.</p>

<p><img src="/blog/images/2020-03-19-Colab_VS_Code/\image-20200319200242198.png" alt="image-20200319200242198" /></p>

<p>You can also clone the notebook from <a href="https://github.com/sheikmohdimran/Experiments_2020/blob/master/code_server.ipynb">here</a> into your account to see this live in action.</p>

<blockquote>
  <p><strong>Note:</strong></p>

  <p>Prior to starting any new notebook, ensure you execute the command below, to avoid import errors..</p>
  <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">!pip install -r requirements.txt
</span></code></pre></div>  </div>
</blockquote>

<h5 id="references">References:</h5>

<ul>
  <li>https://forums.fast.ai/</li>
  <li>https://unix.stackexchange.com/questions/478544/connect-to-vm-through-ssh-google-colab-and-putty</li>
  <li>https://imadelhanafi.com/posts/google_colal_server/</li>
</ul>
