<p>Long history short, in my workplace I had to use VSCode on a Container, running inside a docker host, which is accessible only via a Jump Server (security measures). Looked up at many tutorials on the net to get this done, but more or less all of them involved installing docker on my window laptop. Tinkered around a few steps and made it work. Below given is the step by step instruction on how to do this, if you had a similar problem.</p>

<p><img src="/blog/images/2020-03-11-COVID19/image-20210718203123454.png" alt="" title="image-20210718203123454" /></p>

<p>I’ve already setup passwordless login to the Jump server and docker host, there are many articles on doing this, so I am going to skip that part.</p>

<p>So first, start the container on the docker host and setup SSH Server in the container.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#On Container:</span>
<span class="c">#install ssh server</span>
apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install  </span>openssh-server 

<span class="c">#change root password</span>
passwd 

<span class="c">#Enable to login as root via ssh</span>
<span class="nb">echo</span> <span class="s2">"PermitRootLogin yes"</span> <span class="o">&gt;&gt;</span> /etc/ssh/sshd_config

<span class="c">#Start SSH Server</span>
/etc/init.d/ssh start
</code></pre></div></div>

<p>Once done get the IP address of the container with the following command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#From Host</span>
docker inspect <span class="nt">-f</span> <span class="s2">""</span> bold_cori
</code></pre></div></div>

<p>Check if the login works with the IP identified in the earlier step.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@&lt;container_IP<span class="o">}&gt;</span>
</code></pre></div></div>

<p>Next we need to install ‘<a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh">Remote - SSH</a>’ in VSCode. This help with connecting you local VSCode to VS Code Server on the remote system.</p>

<p><img src="https://code.visualstudio.com/assets/docs/remote/ssh/architecture-ssh.png" alt="SSH Architecture" /></p>

<p>Configure <code class="highlighter-rouge">ssh_config</code> in VSCode, so that you can login without password to the main server</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host Jump
  HostName &lt;Jump_host_IP&gt;
  User &lt;Jump_host_username&gt;
  IdentityFile &lt;Location_of_id_rsa_configured_for_passwordless_login&gt;
Host DockerHost
  HostName &lt;DockerHost_IP&gt;
  User &lt;DockerHost_Username&gt;
  ProxyCommand ssh.exe <span class="nt">-q</span> <span class="nt">-W</span> %h:%p Jump
  IdentityFile &lt;Location_of_id_rsa_configured_for_passwordless_login&gt;
Host DockerContainer
  HostName &lt;DockerContainer_IP&gt;
  User &lt;DockerHost_Username&gt;
  ProxyCommand ssh.exe <span class="nt">-q</span> <span class="nt">-W</span> %h:%p DockerHost
</code></pre></div></div>

<p>Once the setup is completed, login to the docker container from VSCode.</p>

<p>If you are using Jupyter with VSCode ensure to <a href="https://github.com/microsoft/vscode-python/issues/14977#issuecomment-831304980">Disable experiments</a> to make sure the python connect works with .</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Edit in settings.json</span>

<span class="o">{</span>
    <span class="s2">"notebook.experimental.useMarkdownRenderer"</span>: <span class="nb">false</span>,
    <span class="s2">"terminal.integrated.experimentalLinkProvider"</span>: <span class="nb">false</span>,
    <span class="s2">"python.languageServer"</span>: <span class="s2">"Pylance"</span>,
    <span class="s2">"terminal.integrated.shell.linux"</span>: <span class="s2">"/bin/bash"</span>,
    <span class="s2">"python.defaultInterpreterPath"</span>: <span class="s2">"/usr/bin/python3"</span>,
    <span class="s2">"python.experiments.enabled"</span>: <span class="nb">false</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note: If re-connecting to a same IP address with a new container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Edit path of <span class="s2">"known_hosts"</span> given <span class="k">in </span>output window to remove entry <span class="k">for </span>the IP address.
</code></pre></div></div>

